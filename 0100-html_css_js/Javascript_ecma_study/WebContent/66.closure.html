<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>闭包基础</title>
</head>
<script type="text/javascript">
console.log("闭包的第一种形式:");
function F(){
	var b="b";
	//F()函数返回一个匿名函数，这是一个闭包
	return function(){
		return b;
	}
}
//console.log(b);//肯定不能这样访问 局部变量b

var N=F();
console.log(N());
console.log(F()());//简化一下


console.log("闭包的第二种形式:");
var N1;
function F1(){
	var b="b";
	N1=function(){//把闭包赋值给全局变量
		return b;
	}
}
F1();//先执行函数，N1才会变成函数
console.log(N1());

console.log("闭包的第三种形式:");
function F3(arg){
	var n=function(){
		return arg;
	}
	arg++;
	return n;//把匿名函数赋值给变量，并返回，这也是一个闭包
}
console.log(F3(1)());

console.log("自执行函数中用闭包:");
(function functionValued() {
	  return function () {
		 console.log('returned function is called');
	  };
 })()();//理解两个括号的意思
 
 //也可以这样
(function functionValued() {
	  return function () {
		 console.log('returned function is called');
	  };
}())();

 //匿名函数1
(function() {
	  return function () {
		 console.log('returned function is called');
	  };
}())();
//匿名函数2
(function() {
	  return function () {
		 console.log('returned function is called');
	  };
}())();

console.log("循环中的闭包:");
function F4(){
	var a=[];
	for(var i=0;i<3;i++){
		a[i]=function(){ //每一个数组元素都保存一个函数，但是他们都引用了同一个函数，因为在一个作用域里面后面的匿名函数覆盖了前面的匿名函数的定义
			return i;
		}
	}
	return a;
}
var array=F4();
for( j=0;j<array.length;j++){
	console.log(array[j]());
}
//简化
console.log("简化--");
for( j=0;j<array.length;j++){
	console.log(F4()[j]());
}

console.log("循环中的闭包2:");
function F5(){
	var a=[];
	for(var i=0;i<3;i++){
		/*1.闭包代码
		  function(){ 
			return i;
		  }
		  2.改造 return  闭包代码，返回一个函数
		 	return	function(){ 
			  return x;
			}
		*/
		//3.把代码2放到自执行函数里面 (function(){//代码2}())，这样就执行函数，执行结果是返回不同的函数，并把数组索引做实参
		a[i]=(function(x){//x是自执行函数的形参
			 return	function(){ 
					return x;
				}	
			}(i));//i是自执行函数的实参
	}
	return a;
}
var array=F5();
for( j=0;j<array.length;j++){
		console.log(array[j]());
}
console.log("2不好理解，那么看循环中的闭包3:");
function F6(){
	function makeClosure(x){ //创建一个闭包函数
		return function(){
			return x;
		}
	}
	var a=[];
	for(i=0;i<3;i++){
		a[i]=makeClosure(i);
	}
	return a;
}
var array=F6();
for( j=0;j<array.length;j++){
		console.log(array[j]());
}
</script>
</html>